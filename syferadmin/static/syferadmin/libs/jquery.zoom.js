(function($){var defaults={url:false,callback:false,target:false,duration:120,on:"mouseover",touch:true};$.zoom=function(target,source,img){var outerWidth,outerHeight,xRatio,yRatio,offset,position=$(target).css("position");$(target).css({position:/(absolute|fixed)/.test()?position:"relative",overflow:"hidden"});$(img).css({width:"naturalWidth"in img?img.naturalWidth:img.width,height:"naturalHeight"in img?img.naturalHeight:img.height});return{init:function(){outerWidth=$(target).outerWidth();outerHeight=$(target).outerHeight();xRatio=(img.width-outerWidth)/$(source).outerWidth();yRatio=(img.height-outerHeight)/$(source).outerHeight();offset=$(source).offset()},move:function(e){var left=e.pageX-offset.left,top=e.pageY-offset.top;if(img.width<$(source).width()*.9&&img.height<$(source).height()*.9){return false}top=Math.max(Math.min(top,outerHeight),0);left=Math.max(Math.min(left,outerWidth),0);$(img).css("left",left*-xRatio);$(img).css("top",top*-yRatio);return true}}};$.fn.zoom=function(options){if(options==="destroy"){this.off(".zoom").find(".zoomImg").detach();return this}return this.each(function(){var settings=$.extend({},defaults,options||{}),target=settings.target||this,source=this,img=$("<img>").get(0),$img=$(img),mousemove="mousemove",clicked=false;$img.addClass("zoomImg").css({position:"absolute",top:0,left:0,opacity:0,border:"none",maxWidth:"none",maxHeight:"none"}).appendTo(target);if(!settings.url){if($(source).data("zoom")){settings.url=$(source).data("zoom")}else{settings.url=$(source).find("img").attr("src")}if(!settings.url){return}}img.onload=function(){var zoom=$.zoom(target,source,img);function start(e){zoom.init();if(!zoom.move(e)){return false}$(target).addClass("zoomed");$img.stop().fadeTo($.support.opacity?settings.duration:0,1)}function stop(){$img.stop().fadeTo(settings.duration,0);$(target).removeClass("zoomed")}if(settings.on==="grab"){$(source).on("mousedown.zoom",function(e){$(document).one("mouseup.zoom",function(){stop();$(document).off(mousemove,zoom.move)});start(e);$(document).on(mousemove+".zoom",zoom.move);e.preventDefault()})}else if(settings.on==="click"){$(source).on("click.zoom",function(e){if(clicked){return}else{clicked=true;start(e);$(document).on(mousemove+".zoom",zoom.move);$(document).one("click.zoom",function(){stop();clicked=false;$(document).off(mousemove+".zoom",zoom.move)});return false}})}else if(settings.on==="toggle"){$(source).on("click.zoom",function(e){if(clicked){stop()}else{start(e)}clicked=!clicked})}else{zoom.init();$(source).on("mouseenter.zoom",start).on("mouseleave.zoom",stop).on(mousemove+".zoom",zoom.move)}if(settings.touch===true){$(source).on("touchmove.zoom",function(e){e.preventDefault();e.stopPropagation();var touch=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];e.pageX=touch.pageX;e.pageY=touch.pageY;zoom.move(e)}).on("touchstart.zoom",function(e){e.preventDefault();e.stopPropagation();start(e)}).on("touchend.zoom touchleave.zoom",function(e){e.preventDefault();e.stopPropagation();stop(e)})}if($.isFunction(settings.callback)){settings.callback.call(img)}};img.src=settings.url})};$.fn.zoom.defaults=defaults})(window.jQuery);